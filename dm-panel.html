<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>DM Panel PRO — Turbo Master Dragon™</title>
<meta name="theme-color" content="#00ff7b" />
<meta name="description" content="Panel para Masters: intros épicas, ambiente musical y efectos Shaolín.">
<style>
  :root{
    --green:#00ff7b; --accent:#ffd166; --line:#113c2d;
    --panel:#06130f; --panel2:#0a1d17; --text:#eafff5;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%}
  body{
    background:#000; color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    line-height:1.55; overflow-x:hidden;
  }
  .wrap{max-width:1100px; margin:0 auto; padding:18px 14px}
  header.hero{
    margin-top:18px; margin-bottom:16px; text-align:center;
    padding:18px; border:1px solid var(--line); border-radius:14px; background:var(--panel);
    box-shadow:0 0 38px rgba(0,255,150,.08), inset 0 0 22px rgba(0,255,140,.04);
  }
  .title{font-size:clamp(24px,4.2vw,40px); font-weight:900; letter-spacing:.04em;
    color:var(--green); text-shadow:0 0 16px rgba(0,255,150,.6);}
  .subtitle{color:#cfe; opacity:.95; margin-top:6px}
  .cta{display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin-top:12px}
  .btn{
    display:inline-flex; align-items:center; justify-content:center; gap:8px;
    padding:10px 14px; border-radius:999px; border:1px solid var(--green);
    background:linear-gradient(180deg,#02140f,#031b14); color:var(--green); text-decoration:none;
    font-weight:800; letter-spacing:.02em; cursor:pointer;
    box-shadow:0 0 10px var(--green),0 0 18px rgba(0,255,140,.45);
    transition:transform .12s ease, box-shadow .2s ease;
  }
  .btn:hover{ transform:translateY(-1px); box-shadow:0 0 16px var(--green),0 0 32px rgba(0,255,140,.55)}
  .btn.alt{ border-color:var(--accent); color:var(--accent);
    box-shadow:0 0 10px var(--accent),0 0 18px rgba(255,209,102,.45)}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content:center}
  .slider{accent-color:#00ff7b; width:min(280px,60vw)}
  .small{font-size:.92rem; opacity:.92; color:#cfe}
  footer{margin:22px 0 18px; text-align:center; color:#9edfc9; font-size:.95rem; border-top:1px solid var(--line); padding-top:12px}
  .mini{opacity:.75; font-size:.9rem; margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <header class="hero">
    <div class="title">DM Panel PLAYER-PARAMEDIC PRO — Turbo Master Dragon™</div>
    <div class="subtitle">Intros épicas, ambientación y efectos Shaolín.</div>
    <div class="cta">
      <button class="btn" id="btnAmbient"><span id="icoAmbient">▶</span> Ambient: Iniciar</button>
      <button class="btn" id="btnStopAll">⛔ Parar TODO</button>
    </div>

    <div class="row" style="margin-top:8px">
      <label class="small">Volumen
        <input type="range" id="volMaster" class="slider" min="0" max="1" step="0.01" value="0.7" />
      </label>
      <label class="small">Intro
        <select id="introStyle">
          <option value="epic">Épica (fanfarria)</option>
          <option value="shaolin">Mística Shaolín</option>
          <option value="curvista">Curvista ligera</option>
        </select>
      </label>
    </div>
  </header>

  <section class="small" style="text-align:center">
    Consejo: toca “Ambient: Iniciar” y comienza el espectáculo.  
    La intro elegida sonará (fanfarria o gong) y luego quedará un ambiente en loop.
  </section>

  <footer>
    © 2025 Constantino y Federico García — <em>Curvism instead cubism™</em>.
    <div class="mini">DM Panel PRO · Intros multiperfil.</div>
  </footer>
</div>

<!-- Ambient de fondo -->
<audio id="ambientAudio" src="audio/transitions/dron-dos-minutos.mp3" loop preload="auto" playsinline></audio>

<script>
/* ================== INTROS MULTIPERFIL (Épica / Shaolín / Curvista) ================== */
(function(){
  const ambient     = document.getElementById('ambientAudio');
  const btnAmbient  = document.getElementById('btnAmbient');
  const btnStopAll  = document.getElementById('btnStopAll');
  const volMaster   = document.getElementById('volMaster');
  const introSelect = document.getElementById('introStyle');

  // Crear icono del botón
  const icoSpan = (function(){
    let i = document.getElementById('icoAmbient');
    if (!i) {
      i = document.createElement('span');
      i.id = 'icoAmbient';
      i.textContent = '▶';
      btnAmbient?.insertBefore(i, btnAmbient.firstChild);
    }
    return i;
  })();

  // Archivos de intros (asegúrate que existen en audio/)
  const INTROS = {
    epic: [
      "audio/transitions/fanfarra-epic.mp3",
      "audio/battle/horde-war-drums-loop.mp3",
      "audio/scene/ten-seconds-applause.mp3"
    ],
    shaolin: [
      "audio/ritual/gong-dong-gong.mp3",
      "audio/bless/indian-flute-music-soothing.mp3",
      "audio/bless/wind-chime-ambience.mp3"
    ],
    curvista: [
      "audio/transitions/intro-30-secs-claping.mp3",
      "audio/bless/magic harp-arpeggio.mp3",
      "audio/transitions/downsweep-sound-effect.mp3"
    ]
  };

  let audioUnlocked = false;
  let introPlaying  = false;
  let introIndex    = 0;
  let introAudio    = null;

  // Restaurar estilo guardado
  try{
    const v = localStorage.getItem("dm_intro_style");
    if (v && INTROS[v]) introSelect.value = v;
  }catch(_){}
  introSelect?.addEventListener('change', ()=>{
    try{ localStorage.setItem("dm_intro_style", introSelect.value); }catch(_){}
  });

  function currentVol(){
    const v = parseFloat(volMaster?.value || '0.7');
    return isNaN(v) ? 0.7 : v;
  }
  function unlock(){
    if (audioUnlocked) return;
    const a = new Audio();
    a.play().catch(()=>{});
    audioUnlocked = true;
  }
  window.addEventListener('pointerdown', unlock, {once:true});

  function setBtnState(text, icon){
    if (!btnAmbient) return;
    icoSpan.textContent = icon || '▶';
    btnAmbient.innerHTML = '';
    btnAmbient.appendChild(icoSpan);
    btnAmbient.appendChild(document.createTextNode(' Ambient: ' + (text || 'Iniciar')));
  }
  function setBtnStatePlaying(isPlaying){
    if (isPlaying){ setBtnState('Pausar','⏸'); }
    else           { setBtnState('Iniciar','▶'); }
  }

  function startAmbientLoop(){
    try{ ambient.volume = currentVol(); ambient.play().catch(()=>{}); }catch(_){}
    setBtnStatePlaying(true);
  }
  function stopAmbientLoop(){
    try{ ambient.pause(); ambient.currentTime = 0; }catch(_){}
    setBtnStatePlaying(false);
  }

  function getIntroSeq(){
    const key = (introSelect?.value || 'epic').toLowerCase();
    return INTROS[key] || INTROS.epic;
  }

  function playIntroSequence(){
    if (introPlaying) return;
    introPlaying = true;
    introIndex   = 0;
    setBtnState("⏳ Iniciando espectáculo…","⏹");

    const seq = getIntroSeq();

    const next = ()=>{
      if (introIndex >= seq.length){
        introPlaying = false;
        setBtnStatePlaying(true);
        startAmbientLoop(); // entra el loop al final
        return;
      }
      try{
        if (introAudio){ introAudio.onended = null; introAudio = null; }
        const url = seq[introIndex++];
        introAudio = new Audio(url);
        introAudio.volume = currentVol();
        introAudio.onended = next;
        introAudio.play().catch(()=>{ next(); });
      }catch(e){ next(); }
    };

    next();
  }

  function stopIntro(){
    if (introAudio){
      try{ introAudio.pause(); introAudio.currentTime = 0; }catch(_){}
      introAudio.onended = null;
      introAudio = null;
    }
    introPlaying = false;
  }

  volMaster?.addEventListener('input', ()=>{
    const v = currentVol();
    try{ ambient.volume = v; }catch(_){}
    try{ if (introAudio) introAudio.volume = v; }catch(_){}
  });

  btnAmbient?.addEventListener('click', ()=>{
    unlock();
    if (introPlaying){
      stopIntro(); setBtnStatePlaying(false);
      return;
    }
    if (ambient.paused){
      playIntroSequence();
    } else {
      stopAmbientLoop();
    }
  });

  btnStopAll?.addEventListener('click', ()=>{
    stopIntro();
    stopAmbientLoop();
  });
})();
</script>
</body>
</html>