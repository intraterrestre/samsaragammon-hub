<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Discoteca Nirvana ‚Äî DJ Shaolin Pro+‚Ñ¢</title>
<meta name="theme-color" content="#1a1916"/>

<style>
  :root{
    /* Tema √°mbar mon√°stico */
    --bg:#0f0f0d;        /* fondo pizarra */
    --panel:#151412;     /* tarjetas */
    --ink:#f8efe0;       /* texto principal */
    --muted:#dac9a8;     /* texto suave */
    --edge:#3b372f;      /* bordes */
    --amber:#f0b849;     /* acento √°mbar */
    --green:#84fba2;     /* OK / leds */
    --danger:#f7a3a3;    /* stop */
  }
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,"Helvetica Neue",Arial}
  .wrap{max-width:1080px;margin:24px auto;padding:16px}

  .card{background:var(--panel);border:1px solid var(--edge);border-radius:16px;
        box-shadow:0 10px 32px rgba(0,0,0,.35);overflow:hidden}
  .panel{padding:16px}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .right{margin-left:auto}
  h1,h2,h3{margin:.6rem 0}
  .muted{color:var(--muted)}
  .small{font-size:.92rem}

  .btn{background:#191712;border:1px solid var(--edge);color:var(--ink);
       padding:9px 12px;border-radius:10px;cursor:pointer}
  .btn.ghost{background:transparent}
  .btn.ok{border-color:#1e3a29;background:#14231b}
  .btn.stop{border-color:#402323;background:#271616;color:var(--danger)}
  .pill{font-size:.86rem;border-radius:999px;padding:6px 10px}

  /* HERO: SIN animaciones */
  .hero{padding:12px}
  .hero img#poster{
    display:block;width:100%;max-width:720px;height:auto;margin:0 auto;
    border-radius:14px;border:1px solid var(--edge);
    box-shadow:0 12px 36px rgba(0,0,0,.35);
  }

  /* Barra de chips (centrada) */
  .catbar{display:flex;justify-content:center;flex-wrap:wrap;gap:10px;margin:8px 0 0}
  .chip{border:1px solid var(--edge);background:#1b1a16;border-radius:999px;
        padding:6px 10px;color:var(--ink);cursor:pointer}
  .chip:hover{background:#201f19}

  /* Arsenal */
  #arsenal{scroll-margin-top:20px}
  details{border:1px dashed var(--edge);border-radius:12px;background:#13120f;margin-bottom:12px}
  details>summary{list-style:none;cursor:pointer;padding:12px 14px;border-bottom:1px dashed var(--edge);background:#191813;border-radius:12px 12px 0 0}
  details[open]>summary{border-bottom-color:transparent}
  /* [DJ] BLOQUE A ‚Äî Lista de efectos en 2 columnas */
.sfx-list{
  padding:10px 12px;
  display:flex;
  flex-wrap:wrap;
  gap:8px;
}

.sfx-item{
  flex:0 0 calc(50% - 4px);   /* 2 columnas */
  display:flex;
  align-items:center;
  gap:8px;
  padding:8px;
  border-bottom:1px dotted #2b281f;
  box-sizing:border-box;
}

.sfx-item:last-child{
  border-bottom:1px dotted #2b281f; /* da igual, el wrap ya manda */
}

/* opcional: para que los presets tambi√©n se acomoden bonito */
.presets-grid{
  flex-wrap:wrap;
  gap:8px;
}
.presets-grid .btn{
  flex:0 0 calc(50% - 6px);
  justify-content:flex-start;
}
  .led{width:8px;height:8px;border-radius:999px;background:#38352c;border:1px solid #4b4639}
  .led.on{background:var(--green);box-shadow:0 0 8px var(--green)}
  .name{flex:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

  input[type="range"]{width:220px}
  footer{padding:14px;text-align:center;color:var(--muted)}
</style>
</head>
<body>
  <div class="wrap">

    <!-- Back -->
    <div class="row" style="margin-bottom:8px">
      <a class="btn" href="./index.html">‚Üê Volver al Hospital</a>
      <span class="right small muted">Miniteca Nirvana ‚Äî <strong>DJ Shaolin Pro+‚Ñ¢</strong></span>
    </div>

    <!-- HERO: Buda DJ (nombre EXACTO) -->
    <section class="card panel hero" id="top">
      <img id="poster"
           src="./assets/buda-dj-poster.png"
           alt="Buda DJ se√±alando la luna y haciendo scratch"
           width="1280" height="720" loading="eager" decoding="async">
      <p class="small muted" style="text-align:center;margin:.6rem 0 0">Discoteca Nirvana ‚Äî Panel Shaolin Pro+‚Ñ¢</p>
      <p class="small" style="text-align:center;margin:.2rem 0 0;color:#ffd27a">
        Idea de mezcla: üåø Naturaleza + ‚ú® Bendici√≥n + üé≠ Escena (volumen bajo).
      </p>
    </section>

    <!-- Ambiente hospitalario -->
    <section class="card panel" style="margin-top:12px">
      <h2>Ambiente Hospitalario</h2>
      <p class="small muted">Pulso: <em>latido alto</em> + <em>sirena lejana</em>. Inicia para ambientar tu mesa.</p>
      <div class="row">
        <button id="btnAmb" class="btn ok">‚ñ∂Ô∏é ENCIENDE AQU√ç TU MINITECA </button>
        <button id="btnStopAmb" class="btn stop">‚ñ† Detener</button>
        <a class="btn ghost" href="./dm-panel.html">üéõ Abrir DM Panel PRO</a>
        <span class="right small muted">Si no se oye, toca ‚ÄúIniciar ambiente‚Äù.</span>
      </div>
      <div class="row" style="margin-top:8px">
        <span class="small muted">Volumen maestro</span>
        <input id="vol" type="range" min="0" max="1" step="0.01" value="0.72">
        <span class="pill muted">Reproducci√≥n: <span id="nowPlaying">0</span></span>
      </div>
    </section>

    <!-- Presets -->
    <!-- [DJ] BLOQUE B ‚Äî Presets para 12 juegos -->
<section class="card panel" style="margin-top:12px">
  <h2>Presets por Juego</h2>
  <p class="small muted">Elige tu campa√±a: el DJ Buda adapta el clima sonoro al tipo de batalla interior.</p>

  <div class="row presets-grid">
    <button class="btn pill" id="presetRisk">üéñ Risk ‚Äî Invasi√≥n √âpica</button>
    <button class="btn pill" id="presetMonopoly">üí∏ Monopoly ‚Äî Capitalismo K√°rmico</button>

    <button class="btn pill" id="presetCatan">üåæ Catan ‚Äî Aldea en Expansi√≥n</button>
    <button class="btn pill" id="presetDnD5e">üêâ D&D 5e ‚Äî Calabozo Interior</button>

    <button class="btn pill" id="presetUno">üÉè UNO ‚Äî Caos de Colores</button>
    <button class="btn pill" id="presetChess">‚ôüÔ∏è Ajedrez ‚Äî Guerra Silenciosa</button>

    <button class="btn pill" id="presetMTG">‚ú® Magic ‚Äî Duelo de Planeswalkers</button>
    <button class="btn pill" id="presetTenCandles">üïØ Ten Candles ‚Äî √öltima Noche</button>

    <button class="btn pill" id="presetCarcassonne">üè∞ Carcassonne ‚Äî Camino del Monje</button>
    <button class="btn pill" id="presetTrivial">üß† Trivial ‚Äî Tormenta de Preguntas</button>

    <button class="btn pill" id="presetClue">üîç Clue ‚Äî Misterio en la Mansi√≥n</button>
    <button class="btn pill" id="presetPictionary">üé® Pictionary/Dixit ‚Äî Visiones en la Mesa</button>
  </div>
    </section>

    <!-- Chips de categor√≠as -->
    <section class="card panel" style="margin-top:12px">
      <div id="catbar" class="catbar"></div>
    </section>

    <!-- Arsenal visible -->
    <section class="card panel" id="arsenal" style="margin-top:12px">
      <h2 style="margin:0 0 6px 0">Shaolin Pro+ ‚Äî Efectos por categor√≠a</h2>
      <p class="small muted">Dispara varios sonidos a la vez. Un LED verde indica qu√© pista est√° sonando.</p>
      <div id="catalog"></div>
      <div class="row" style="margin-top:10px">
        <button class="btn" id="btnStopLast">‚èπ Parar √∫ltimo</button>
        <button class="btn stop" id="btnStopAll">‚õî Parar TODO</button>
      </div>
    </section>

    <footer>¬© 2025 Constantino & Federico Garc√≠a ‚Äî Curvism instead cubism‚Ñ¢</footer>
  </div>

  <!-- Audio ambiente (latido + sirena) -->
  <audio id="aHeart" src="./audio/nature/heart-beat.mp3" preload="auto" loop playsinline></audio>
  <audio id="aSiren" src="./audio/alarms/ambulancia-sixteen-secs.mp3" preload="auto" loop playsinline></audio>

<!-- ============================= -->
<!--  [DJ] BLOQUE C ‚Äî CAT√ÅLOGO    -->
<!--  INLINE + DURACIONES (s)     -->
<!-- ============================= -->
<script>
const EFX_INLINE = {
  "alarms": [
    ["ambulancia-sixteen-secs","audio/alarms/ambulancia-sixteen-secs.mp3",16],
    ["ambulance-siren","audio/alarms/ambulance-siren.mp3",33],
    ["boat-siren-sinking","audio/alarms/boat-siren-sinking.mp3",29],
    ["call-to-attention","audio/alarms/call-to-attention.mp3",4],
    ["car-alarm","audio/alarms/car-alarm.mp3",32],
    ["cellphone-ringtone-huawei","audio/alarms/cellphone-ringtone-huawei.mp3",29],
    ["eleven-siren","audio/alarms/eleven-siren.mp3",31],
    ["emergency-alert-siren","audio/alarms/emergency-alert-siren.mp3",34],
    ["high-low-siren","audio/alarms/high-low-siren.mp3",7],
    ["mega-horn","audio/alarms/mega-horn.mp3",12],
    ["patroll","audio/alarms/patroll.mp3",27],
    ["ringphone-rock","audio/alarms/ringphone-rock.mp3",23],
    ["siren-blips","audio/alarms/siren-blips.mp3",5],
    ["sirene-alarm","audio/alarms/sirene-alarm.mp3",33],
    ["sos-signal-morse","audio/alarms/sos-signal-morse.mp3",19],
    ["train-crossing-signal","audio/alarms/train-crossing-signal.mp3",20]
  ],
  "animal": [
    ["baby-crying","audio/animal/baby-crying.mp3",29],
    ["barking-dog","audio/animal/barking-dog.mp3",10],
    ["big-dog","audio/animal/big-dog.mp3",12],
    ["bird-conversation","audio/animal/bird-conversation.mp3",37],
    ["bird-song-forest","audio/animal/bird-song-forest.mp3",31],
    ["bull-angry","audio/animal/bull-angry.mp3",16],
    ["buho","audio/animal/buho.mp3",2],
    ["burrada","audio/animal/burrada.mp3",8],
    ["cat-meowing","audio/animal/cat-meowing.mp3",18],
    ["chimpanzee","audio/animal/chimpanzee.mp3",6],
    ["cochino","audio/animal/cochino.mp3",5],
    ["cow-moo","audio/animal/cow-moo.mp3",28],
    ["culebra-cascabel","audio/animal/culebra-cascabel.mp3",13],
    ["donkey-bray-36757","audio/animal/donkey-bray-36757.mp3",15],
    ["gatico","audio/animal/gatico.mp3",4],
    ["goat-meh","audio/animal/goat-meh.mp3",18],
    ["horse-galloping","audio/animal/horse-galloping.mp3",52],
    ["horse-neigh","audio/animal/horse-neigh.mp3",22],
    ["kikiriki-gallo","audio/animal/kikiriki-gallo.mp3",7],
    ["lion-loud","audio/animal/lion-loud.mp3",10],
    ["mono","audio/animal/mono.mp3",5],
    ["monster-roar-2","audio/animal/monster-roar-2.mp3",6],
    ["monster-roars","audio/animal/monster-roars.mp3",5],
    ["owl-hooting","audio/animal/owl-hooting.mp3",24],
    ["pajaro-en-ramas","audio/animal/pajaro-en-ramas.mp3",26],
    ["pig-oink","audio/animal/pig-oink.mp3",18],
    ["pigeon","audio/animal/pigeon.mp3",16],
    ["rooster-crow","audio/animal/rooster-crow.mp3",7],
    ["sheep-bleating","audio/animal/sheep-bleating.mp3",16],
    ["snake-hiss","audio/animal/snake-hiss.mp3",8],
    ["wolf-howl","audio/animal/wolf-howl.mp3",8]
  ],
  "battle": [
    ["air-raid-siren","audio/battle/air-raid-siren.mp3",32],
    ["bomb-explosion","audio/battle/bomb-explosion.mp3",4],
    ["bullet-whizz","audio/battle/bullet-whizz.mp3",6],
    ["civil-war-fanfares","audio/battle/civil-war-fanfares.mp3",19],
    ["gun-fight-1","audio/battle/gun-fight-1.mp3",16],
    ["gun-fight-2","audio/battle/gun-fight-2.mp3",26],
    ["gun-shots-far","audio/battle/gun-shots-far.mp3",29],
    ["gunfire-ambience","audio/battle/gunfire-ambience.mp3",31],
    ["grenade-pin-pull","audio/battle/grenade-pin-pull.mp3",4],
    ["grito-guerra","audio/battle/grito-guerra.mp3",4],
    ["horde-war-drums-loop","audio/battle/horde-war-drums-loop.mp3",70],
    ["loud-explosion","audio/battle/loud-explosion.mp3",6],
    ["machine-gun","audio/battle/machine-gun.mp3",7],
    ["marching","audio/battle/marching.mp3",20],
    ["metal-shield-hit","audio/battle/metal-shield-hit.mp3",2],
    ["military-drums","audio/battle/military-drums.mp3",18],
    ["sword-sounds-slice-slash-crash-swoosh","audio/battle/sword-sounds-slice-slash-crash-swoosh.mp3",31],
    ["war-ambience","audio/battle/war-ambience.mp3",30]
  ],
  "bless": [
    ["angel-choir-long","audio/bless/angel-choir-long.mp3",82],
    ["angelic-choir-intro","audio/bless/angelic-choir-intro.mp3",21],
    ["blessing-echo","audio/bless/blessing-echo.mp3",11],
    ["bright-sparkle","audio/bless/bright-sparkle.mp3",5],
    ["church-temple-gong","audio/bless/church-temple-gong.mp3",17],
    ["choir-shimmer","audio/bless/choir-shimmer.mp3",11],
    ["holy-chants","audio/bless/holy-chants.mp3",62],
    ["mystic-chimes","audio/bless/mystic-chimes.mp3",27],
    ["organ-chord","audio/bless/organ-chord.mp3",7]
  ],
  "nature": [
    ["campfire","audio/nature/campfire.mp3",36],
    ["cave-drips","audio/nature/cave-drips.mp3",31],
    ["city-rain","audio/nature/city-rain.mp3",67],
    ["crickets-night","audio/nature/crickets-night.mp3",32],
    ["forest-day","audio/nature/forest-day.mp3",63],
    ["heart-beat","audio/nature/heart-beat.mp3",47],
    ["rain-thunder","audio/nature/rain-thunder.mp3",32],
    ["stream","audio/nature/stream.mp3",45],
    ["storm-thunder-night","audio/nature/storm-thunder-night.mp3",34],
    ["waves-beach","audio/nature/waves-beach.mp3",63],
    ["wind","audio/nature/wind.mp3",31],
    ["wind-strong","audio/nature/wind-strong.mp3",33]
  ],
  "ritual": [
    ["bansuri","audio/ritual/bansuri.mp3",40],
    ["bowl-long","audio/ritual/bowl-long.mp3",70],
    ["frame-drum","audio/ritual/frame-drum.mp3",53],
    ["gong-deep","audio/ritual/gong-deep.mp3",26],
    ["low-om","audio/ritual/low-om.mp3",63],
    ["mantra-chant","audio/ritual/mantra-chant.mp3",71],
    ["shamanic-rattle","audio/ritual/shamanic-rattle.mp3",22]
  ],
  "scene": [
    ["casino-ambience","audio/scene/casino-ambience.mp3",41],
    ["city-street","audio/scene/city-street.mp3",68],
    ["dados","audio/scene/dados.mp3",7],
    ["emperor","audio/scene/emperor.mp3",13],
    ["kids-playing","audio/scene/kids-playing.mp3",35],
    ["market-crowd","audio/scene/market-crowd.mp3",62],
    ["med-bay-beeps","audio/scene/med-bay-beeps.mp3",40],
    ["office-murmur","audio/scene/office-murmur.mp3",47],
    ["party-murmur","audio/scene/party-murmur.mp3",50],
    ["tavern-low","audio/scene/tavern-low.mp3",60]
  ],
  "transitions": [
    ["arcade-coin","audio/transitions/arcade-coin.mp3",3],
    ["boing-poioiong","audio/transitions/boing-poioiong.mp3",2],
    ["china-intro","audio/transitions/china-intro.mp3",8],
    ["chinese-flute-hulusi","audio/transitions/chinese-flute-hulusi.mp3",23],
    ["chinese-transition","audio/transitions/chinese-transition.mp3",10],
    ["cuatro-segundos-asiatic-intro","audio/transitions/cuatro-segundos-asiatic-intro.mp3",4],
    ["downsweep-sound-effect","audio/transitions/downsweep-sound-effect.mp3",6],
    ["dron-dos-minutos","audio/transitions/dron-dos-minutos.mp3",110],
    ["epic-hit","audio/transitions/epic-hit.mp3",3],
    ["fanfara-epic","audio/transitions/fanfara-epic.mp3",13],
    ["flute-melody-280554","audio/transitions/flute-melody-280554.mp3",36],
    ["flauta-flute-melody","audio/transitions/flauta-flute-melody.mp3",32],
    ["funky-distorsion","audio/transitions/funky-distorsion.mp3",18],
    ["game-over","audio/transitions/game-over.mp3",5],
    ["half-minute-chinese-mad-beat","audio/transitions/half-minute-chinese-mad-beat.mp3",32],
    ["hypnotic-diahrea","audio/transitions/hypnotic-diahrea.mp3",19],
    ["intro-30-secs-claping","audio/transitions/intro-30-secs-claping.mp3",32],
    ["intro-subiendo","audio/transitions/intro-subiendo.mp3",22],
    ["mini-banjo","audio/transitions/mini-banjo.mp3",9],
    ["nine-seconds-whoosh","audio/transitions/nine-seconds-whoosh.mp3",9],
    ["one-half-coconut-grove-bongo-drum","audio/transitions/one-half-coconut-grove-bongo-drum.mp3",46],
    ["one-minute-intro-interestelar","audio/transitions/one-minute-intro-interestelar.mp3",63],
    ["pulse","audio/transitions/pulse.mp3",16],
    ["rock-drums","audio/transitions/rock-drums.mp3",30],
    ["seventeen-samurai","audio/transitions/seventeen-samurai.mp3",17],
    ["suspenso-ascendente","audio/transitions/suspenso-ascendente.mp3",18],
    ["ten-seconds-bubbles","audio/transitions/ten-seconds-bubbles.mp3",10],
    ["thirteen-seconds-teletransport","audio/transitions/thirteen-seconds-teletransport.mp3",13],
    ["timer-suspense","audio/transitions/timer-suspense.mp3",11],
    ["video-game-8bit","audio/transitions/video-game-8bit.mp3",7]
  ]
};
</script>

<!-- ============= -->
<!--  L√ìGICA UI    -->
<!-- ============= -->
<script>
(()=>{

  // ---------- Helpers ----------
  const $  = (q,ctx=document)=>ctx.querySelector(q);

  // ---------- Mezclador v2 ----------
  const PLAYING = new Map();     // id -> { audio, key, led }
  const STACK   = [];            // ids en orden (para "Parar √∫ltimo")
  const COUNTS  = new Map();     // key (cat/archivo) -> n¬∫ instancias
  let UID = 0;
  const newId = ()=>'a'+(++UID);

  const MAX_POLYPHONY_GLOBAL = Infinity;
  const MAX_POLY_PER_CAT = {};   // p.ej. { alarms: 6, battle: 8 }

  function updatePlayingCount(){
    const el = $('#nowPlaying'); if (el) el.textContent = PLAYING.size;
  }
  function incKey(key){ COUNTS.set(key,(COUNTS.get(key)||0)+1); }
  function decKey(key){
    const n=(COUNTS.get(key)||0)-1;
    if(n>0) COUNTS.set(key,n); else COUNTS.delete(key);
  }

  function playClip(src,key,led){
    if (MAX_POLYPHONY_GLOBAL!==Infinity && PLAYING.size>=MAX_POLYPHONY_GLOBAL) return null;
    if (key){
      const cat = key.split('/')[0];
      const enCat = Array.from(PLAYING.values()).filter(v=>v.key?.startsWith(cat+'/')).length;
      const cap   = MAX_POLY_PER_CAT[cat] ?? Infinity;
      if (enCat>=cap) return null;
    }

    const a = new Audio(src);
    a.volume = parseFloat($('#vol')?.value || '0.72');
    a.playsInline = true;

    const id = newId();
    PLAYING.set(id,{audio:a,key,led});
    STACK.push(id);
    if(key) incKey(key);
    if(led) led.classList.add('on');
    updatePlayingCount();

    a.addEventListener('ended',()=> hardStop(id),{once:true});
    a.play().catch(()=>{}); // interacci√≥n requerida
    return id;
  }

  function hardStop(id){
    const item = PLAYING.get(id);
    if(!item) return;
    const {audio,key,led} = item;

    try{
      const steps=12, dec=(audio.volume||1)/steps;
      const iv=setInterval(()=>{
        audio.volume=Math.max(0,audio.volume-dec);
        if(audio.volume<=0.001){
          clearInterval(iv);
          try{ audio.pause(); audio.currentTime=0; }catch{}
        }
      },16);
    }catch{
      try{ audio.pause(); audio.currentTime=0; }catch{}
    }

    PLAYING.delete(id);
    const i=STACK.lastIndexOf(id); if(i>-1) STACK.splice(i,1);
    if(key) decKey(key);

    if(led){
      const still = Array.from(PLAYING.values()).some(v=>v.key===key);
      if(!still) led.classList.remove('on');
    }
    updatePlayingCount();
  }

  function stopLast(){
    const last = STACK.pop();
    if(last) hardStop(last);
  }
  function stopAll(){
    // tambi√©n apagamos ambiente
    try{ heart.pause(); heart.currentTime=0; }catch{}
    try{ siren.pause(); siren.currentTime=0; }catch{}
    Array.from(PLAYING.keys()).forEach(hardStop);
  }

  // ---------- Ambiente ----------
  const heart = $('#aHeart');
  const siren = $('#aSiren');
  $('#btnAmb').addEventListener('click', ()=>{
    try{
      heart.currentTime=0; siren.currentTime=0;
      const vol = parseFloat($('#vol').value||'0.72');
      heart.volume=vol; siren.volume=vol;
      heart.play(); siren.play();
    }catch{}
  });
  $('#btnStopAmb').addEventListener('click', ()=>{
    try{ heart.pause(); siren.pause(); }catch{}
  });
  $('#vol').addEventListener('input', e=>{
    const vol=parseFloat(e.target.value||'0.72');
    // aplica a los que est√°n sonando
    for(const {audio} of PLAYING.values()){ try{ audio.volume=vol; }catch{} }
    try{ heart.volume=vol; siren.volume=vol; }catch{}
  });

     // ---------- Presets por juego (12 campa√±as) ----------
    // ---------- Presets por juego (12 campa√±as) ----------
  const GAME_PRESETS = {
    risk(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/battle/15s-horde-war-drums-loop.mp3','battle/horde-war-drums-loop'), 400);
      setTimeout(()=> playClip('audio/battle/61s-civil-war-fanfares.mp3','battle/civil-war-fanfares'), 2400);
      setTimeout(()=> playClip('audio/battle/12s-bomb-explosion.mp3','battle/bomb-explosion'), 5200);
      setTimeout(()=> playClip('audio/battle/2s-grito-guerra.mp3','battle/grito-guerra'), 6500);
    },
    monopoly(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/scene/44s-rulet.mp3','scene/rulet'), 500);
      setTimeout(()=> playClip('audio/scene/65s-spinning-ruleta.mp3','scene/spinning-ruleta'), 2600);
      setTimeout(()=> playClip('audio/scene/30s-pop-pop-corn-popping.mp3','scene/pop-pop-corn-popping'), 5200);
      setTimeout(()=> playClip('audio/scene/10s-game-over.mp3','scene/game-over'), 8200);
    },
    catan(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/nature/17s-wind.mp3','nature/wind'), 300);
      setTimeout(()=> playClip('audio/nature/14s-thunder-and-rumbling.mp3','nature/thunder-and-rumbling'), 2300);
      setTimeout(()=> playClip('audio/animal/30s-ranas-cantando.mp3','animal/ranas-cantando'), 4300);
      setTimeout(()=> playClip('audio/scene/3s-dados.mp3','scene/dados'), 7200);
    },
    dnd5e(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/ritual/19s-cuencos-tibetanos.mp3','ritual/cuencos-tibetanos'), 500);
      setTimeout(()=> playClip('audio/scene/72s-carpintero-tallando.mp3','scene/carpintero-tallando'), 2600);
      setTimeout(()=> playClip('audio/nature/18s-big-thunder.mp3','nature/big-thunder'), 5200);
      setTimeout(()=> playClip('audio/animal/37s-monster-roars.mp3','animal/monster-roars'), 7800);
    },
    uno(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/transitions/2s-poioiong.mp3','transitions/poioiong'), 300);
      setTimeout(()=> playClip('audio/transitions/4s-mini-banjo.mp3','transitions/mini-banjo'), 1300);
      setTimeout(()=> playClip('audio/scene/10s-applause.mp3','scene/applause'), 2600);
      setTimeout(()=> playClip('audio/scene/5s-baby-laughter.mp3','scene/baby-laughter'), 4200);
    },
    chess(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/ritual/13s-indian-flaute.mp3','ritual/indian-flaute'), 600);
      setTimeout(()=> playClip('audio/bless/40s-magic-harp-arpeggio.mp3','bless/magic-harp-arpeggio'), 2600);
      setTimeout(()=> playClip('audio/ritual/22s-tribal-chant-drone.mp3','ritual/tribal-chant-drone'), 6200);
    },
    mtg(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/bless/35-choir-goodbyes-adios.mp3','bless/choir-goodbyes-adios'), 400);
      setTimeout(()=> playClip('audio/nature/60s-thunder-sound.mp3','nature/thunder-sound'), 2600);
      setTimeout(()=> playClip('audio/animal/48s-lion-loud.mp3','animal/lion-loud'), 5200);
      setTimeout(()=> playClip('audio/transitions/13s-teletransport.mp3','transitions/teletransport'), 7800);
    },
    "ten-candles"(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/ritual/21s-short-suspense-dungeons.mp3','ritual/short-suspense-dungeons'), 500);
      setTimeout(()=> playClip('audio/ritual/29s-melancolic.mp3','ritual/melancolic'), 2600);
      setTimeout(()=> playClip('audio/nature/9s-mid-nights-sound.mp3','nature/mid-nights-sound'), 5200);
      setTimeout(()=> playClip('audio/scene/19-witch-laughter.mp3','scene/witch-laughter'), 7800);
    },
    carcassonne(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/nature/301s-cold-snowfall.mp3','nature/cold-snowfall'), 400);
      setTimeout(()=> playClip('audio/ritual/25s-tibetan-buddhist-drum.mp3','ritual/tibetan-buddhist-drum'), 2600);
      setTimeout(()=> playClip('audio/bless/8s-church-bell.mp3','bless/church-bell'), 5200);
    },
    trivial(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/scene/33s-corona-announcement-subway-hvv-hamburg.mp3','scene/corona-announcement-subway'), 500);
      setTimeout(()=> playClip('audio/transitions/16s-timer-suspense.mp3','transitions/timer-suspense'), 2600);
      setTimeout(()=> playClip('audio/transitions/10s-chinese-transition.mp3','transitions/chinese-transition'), 5200);
      setTimeout(()=> playClip('audio/scene/10s-game-over.mp3','scene/game-over'), 7800);
    },
    clue(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/scene/27s-come-back-alive-whisper.mp3','scene/come-back-alive-whisper'), 400);
      setTimeout(()=> playClip('audio/nature/30s-storm-windy.mp3','nature/storm-windy'), 2600);
      setTimeout(()=> playClip('audio/transitions/11s-suspenso-ascendente.mp3','transitions/suspenso-ascendente'), 5200);
      setTimeout(()=> playClip('audio/alarms/17s-siren-blips.mp3','alarms/siren-blips'), 7800);
    },
    pictionary(){
      $('#btnAmb').click();
      setTimeout(()=> playClip('audio/transitions/22s-flute-melody.mp3','transitions/flute-melody'), 500);
      setTimeout(()=> playClip('audio/bless/26s-dizi-flute.mp3','bless/dizi-flute'), 2600);
      setTimeout(()=> playClip('audio/scene/49s-inhales-and-exhales.mp3','scene/inhales-and-exhales'), 5200);
      setTimeout(()=> playClip('audio/scene/8s-help-me.mp3','scene/help-me'), 8800);
    }
  };

  [
    ['presetRisk','risk'],
    ['presetMonopoly','monopoly'],
    ['presetCatan','catan'],
    ['presetDnD5e','dnd5e'],
    ['presetUno','uno'],
    ['presetChess','chess'],
    ['presetMTG','mtg'],
    ['presetTenCandles','ten-candles'],
    ['presetCarcassonne','carcassonne'],
    ['presetTrivial','trivial'],
    ['presetClue','clue'],
    ['presetPictionary','pictionary']
  ].forEach(([btnId,key])=>{
    const btn = $('#'+btnId);
    if(btn && GAME_PRESETS[key]){
      btn.addEventListener('click', ()=> GAME_PRESETS[key]());
    }
  });
  // ---------- Botones globales ----------
  $('#btnStopLast').addEventListener('click', stopLast);
  $('#btnStopAll').addEventListener('click', stopAll);

  // ---------- Pintar chips + cat√°logo ----------
  const ORDER  = ['alarms','animal','battle','transitions','scene','nature','ritual','bless'];
  const TITLES = {
    alarms:'üöë Alarmas',
    animal:'üêæ Animales',
    battle:'‚öîÔ∏è Guerra',
    transitions:'‚û°Ô∏è Transiciones',
    scene:'üé≠ Escena',
    nature:'üåø Naturaleza',
    ritual:'üïØ M√∫sica Ritual',
    bless:'‚ú® Bendiciones M√°gicas'
  };

  function paintCatbar(keys){
    const bar = $('#catbar'); bar.innerHTML='';
    keys.forEach(k=>{
      const chip=document.createElement('span');
      chip.className='chip'; chip.textContent=TITLES[k]||k;
      chip.addEventListener('click',()=>{
        const el=document.getElementById('cat-'+k);
        if(el) el.scrollIntoView({behavior:'smooth',block:'start'});
      });
      bar.appendChild(chip);
    });
  }

  function paintCatalog(data){
    const keys=[...ORDER.filter(k=>data[k]), ...Object.keys(data).filter(k=>!ORDER.includes(k))];
    paintCatbar(keys);

    const cont=$('#catalog'); cont.innerHTML='';
    keys.forEach(k=>{
      const sec=document.createElement('details');
      sec.id='cat-'+k;
      sec.open=true; // grupos abiertos por defecto

      const sum=document.createElement('summary');
      sum.innerHTML=`<strong>${TITLES[k]||k}</strong> <span class="small muted">‚Äî ${data[k].length} pista(s)</span>`;
      sec.appendChild(sum);

      const list=document.createElement('div'); list.className='sfx-list';
      data[k].forEach(([name,src,dur])=>{
        const row  = document.createElement('div'); row.className='sfx-item';
        const led  = document.createElement('span'); led.className='led';
        const label= document.createElement('div');  label.className='name';

        // nombre + segundos (si los hay)
        label.textContent = dur ? `${name} ¬∑ ${dur}s` : name;

        const play = document.createElement('button'); play.className='btn pill';      play.textContent='‚ñ∂ Reproducir';
        const stop = document.createElement('button'); stop.className='btn pill stop'; stop.textContent='‚ñ† Parar √∫ltimo';

        const key = `${k}/${name}`;
        const badge=document.createElement('span'); badge.className='pill muted'; badge.textContent='√ó0';

        function refreshBadge(){
          const n = COUNTS.get(key)||0;
          badge.textContent='√ó'+n;
          if(n===0) led.classList.remove('on');
        }

        play.addEventListener('click', ()=>{
          const id = playClip(src, key, led);
          if(id) refreshBadge();
        });
        stop.addEventListener('click', ()=>{
          stopLast();
          requestAnimationFrame(refreshBadge);
        });

        row.append(led,label,play,stop,badge);
        list.appendChild(row);
      });

      sec.appendChild(list);
      cont.appendChild(sec);
    });
  }

  // Cat√°logo inline (EFX_INLINE) ya est√° definido arriba en este HTML
  paintCatalog(EFX_INLINE);

  // contador global al inicio (0)
  updatePlayingCount();

})();
</script>
</body>
</html>